---
title: OAuth 2.0和OpenID Connect协议的排除故障。
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 03/17/2021
audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "9776"
- "9004342"
ms.openlocfilehash: d2f14d4d16bea890b564cdb9bd9ac3875c28d115
ms.sourcegitcommit: c08bed4071baa3bb5879496df3ed44fb828c8367
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/19/2021
ms.locfileid: "50897582"
---
# <a name="troubleshoot-oauth-20-and-openid-connect-protocols"></a><span data-ttu-id="d526d-102">OAuth 2.0和OpenID Connect协议的排除故障。</span><span class="sxs-lookup"><span data-stu-id="d526d-102">Troubleshoot OAuth 2.0 and OpenID Connect protocols</span></span>

<span data-ttu-id="d526d-103">要解决 OAuth 2.0 和 OpenID Connect 问题，请执行以下建议步骤：</span><span class="sxs-lookup"><span data-stu-id="d526d-103">To resolve OAuth 2.0 and OpenID Connect issues, perform the following recommended steps:</span></span>

<span data-ttu-id="d526d-104">请参阅下列与 OAuth 2.0 和 OpenID Connect 协议的配置和疑难解答相关的文章：</span><span class="sxs-lookup"><span data-stu-id="d526d-104">Refer to the following articles that are related to configuration and troubleshooting OAuth 2.0 and OpenID Connect protocols:</span></span>

- <span data-ttu-id="d526d-105">[Microsoft 标识平台和 OAuth 2.0 授权代码流程](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) - 本文介绍如何使用任意语言直接针对应用程序中的 **代码授予(PKCE)流程** 进行编程。</span><span class="sxs-lookup"><span data-stu-id="d526d-105">[Microsoft identity platform and OAuth 2.0 authorization code flow](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) - This article describes how to program directly against the **code grant (PKCE) flow** in your application, using any language.</span></span>
- <span data-ttu-id="d526d-106">[Microsoft 标识平台和 OAuth 2.0 客户端凭据流程](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow) - 本文介绍如何直接针对应用程序中的 **客户端凭据流程** 进行编程。</span><span class="sxs-lookup"><span data-stu-id="d526d-106">[Microsoft identity platform and the OAuth 2.0 client credentials flow](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow) - This article describes how to program directly against the **client credentials flow** in your application.</span></span>
- <span data-ttu-id="d526d-107">[Microsoft 标识平台和 OAuth 2.0 资源所有者密码凭据](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth-ropc) - 本文介绍如何直接针对应用程序中的 **ROPC 流程** 进行编程。</span><span class="sxs-lookup"><span data-stu-id="d526d-107">[Microsoft identity platform and OAuth 2.0 Resource Owner Password Credentials](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth-ropc) - This article describes how to program directly against the **ROPC flow** in your application.</span></span>
    - <span data-ttu-id="d526d-108">Microsoft 标识平台仅支持适用于 Azure AD 租户的 ROPC，而并不支持个人帐户。</span><span class="sxs-lookup"><span data-stu-id="d526d-108">The Microsoft identity platform only supports ROPC for Azure AD tenants, and not for personal accounts.</span></span> <span data-ttu-id="d526d-109">这意味着必须使用租户特定的端点 **（https://login.microsoftonline.com/{TenantId_or_Name})** 或 **组织** 的端点。</span><span class="sxs-lookup"><span data-stu-id="d526d-109">This means that you must use a tenant-specific endpoint **(https://login.microsoftonline.com/{TenantId_or_Name})** or the **organizations** endpoint.</span></span>
    - <span data-ttu-id="d526d-110">受邀到 Azure AD 租户的个人帐户不能使用 ROPC。</span><span class="sxs-lookup"><span data-stu-id="d526d-110">Personal accounts that are invited to an Azure AD tenant can't use ROPC.</span></span>
    - <span data-ttu-id="d526d-111">没有密码的帐户不能通过 ROPC 登录。</span><span class="sxs-lookup"><span data-stu-id="d526d-111">Accounts that don't have passwords can't sign in through ROPC.</span></span> <span data-ttu-id="d526d-112">对于这种情况，我们建议你为应用使用不同的流程。</span><span class="sxs-lookup"><span data-stu-id="d526d-112">For this scenario, we recommend that you use a different flow for your app, instead.</span></span>
    - <span data-ttu-id="d526d-113">如果用户需要通过 [多种身份验证 (MFA)](https://docs.microsoft.com/azure/active-directory/authentication/concept-mfa-howitworks) 登录到应用程序,用户将被阻止。</span><span class="sxs-lookup"><span data-stu-id="d526d-113">If users need to use [multi-factor authentication (MFA)](https://docs.microsoft.com/azure/active-directory/authentication/concept-mfa-howitworks) to log in to the application, they will be blocked.</span></span>
    - <span data-ttu-id="d526d-114">混合联合身份验证 [方案](https://docs.microsoft.com/azure/active-directory/hybrid/whatis-fed) （例如，用于对本地帐户进行身份验证的 Azure AD 和 ADFS）不支持 ROPC。</span><span class="sxs-lookup"><span data-stu-id="d526d-114">ROPC is not supported in [hybrid identity federation](https://docs.microsoft.com/azure/active-directory/hybrid/whatis-fed) scenarios (for example, Azure AD and ADFS used to authenticate on-premises accounts).</span></span> <span data-ttu-id="d526d-115">如果将用户重定向到本地身份提供程序的完整页面，Azure AD 无法针对该身份提供程序测试用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="d526d-115">If users are full-page redirected to an on-premises identity provider, Azure AD is not able to test the username and password against that identity provider.</span></span> <span data-ttu-id="d526d-116">但是，ROPC 支持[通过式身份验证](https://docs.microsoft.com/azure/active-directory/hybrid/how-to-connect-pta) 。</span><span class="sxs-lookup"><span data-stu-id="d526d-116">[Pass-through authentication](https://docs.microsoft.com/azure/active-directory/hybrid/how-to-connect-pta) is supported with ROPC, however.</span></span>
    - <span data-ttu-id="d526d-117">混合联合身份验证方案的例外是：将 **AllowCloudPasswordValidation** 设置为 **TRUE** 的主领域发现策略将允许 ROPC flow 在本地密码同步到云时，为联合用户工作。</span><span class="sxs-lookup"><span data-stu-id="d526d-117">An exception to a hybrid identity federation scenario would be the following: Home Realm Discovery policy with **AllowCloudPasswordValidation** set to **TRUE** will enable ROPC flow to work for federated users when on-premises password is synced to cloud.</span></span> <span data-ttu-id="d526d-118">有关详细信息，请参阅 [旧版应用程序启用联合用户的直接 ROPC 身份验证](https://docs.microsoft.com/azure/active-directory/manage-apps/configure-authentication-for-federated-users-portal#enable-direct-ropc-authentication-of-federated-users-for-legacy-applications)</span><span class="sxs-lookup"><span data-stu-id="d526d-118">For more information, see [Enable direct ROPC authentication of federated users for legacy applications](https://docs.microsoft.com/azure/active-directory/manage-apps/configure-authentication-for-federated-users-portal#enable-direct-ropc-authentication-of-federated-users-for-legacy-applications)</span></span> 
- <span data-ttu-id="d526d-119">[Microsoft 标识平台和 OAuth 2.0 代表流程](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) - 本文介绍如何直接针对应用程序中的 **代表 (OBO) 流程** 进行编程。</span><span class="sxs-lookup"><span data-stu-id="d526d-119">[Microsoft identity platform and OAuth 2.0 On-Behalf-Of flow](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) - This article describes how to program directly against the **on-behalf-of (OBO) flow** in your application.</span></span>
- <span data-ttu-id="d526d-120">[Microsoft 标识平台和 OpenID Connect 协议](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc)- 本文展示了如何实现独立于语言的OpenID Connect协议 ，并介绍了在不实用任何 Microsoft 开放源代码库的情况下发送和接收 HTTP 消息。</span><span class="sxs-lookup"><span data-stu-id="d526d-120">[Microsoft identity platform and OpenID Connect protocol](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc) - This article shows how to implement the OpenID Connect protocol independent of language, and describes how to send and receive HTTP messages without using any Microsoft open-source libraries.</span></span>

<span data-ttu-id="d526d-121">**访问令牌**</span><span class="sxs-lookup"><span data-stu-id="d526d-121">**Access Tokens**</span></span>

<span data-ttu-id="d526d-122">要了解 API 如何验证和使用访问令牌内的声明，请参阅 [Microsoft 标识平台访问令牌](https://docs.microsoft.com/azure/active-directory/develop/access-tokens)。</span><span class="sxs-lookup"><span data-stu-id="d526d-122">[Microsoft identity platform access tokens](https://docs.microsoft.com/azure/active-directory/develop/access-tokens) - Learn how your API can validate and use the claims inside an access token.</span></span> <span data-ttu-id="d526d-123">本文中除记录外的所有文档都仅适用于已注册的 API 所发布的令牌。</span><span class="sxs-lookup"><span data-stu-id="d526d-123">All documentation in this article, except where noted, applies only to tokens issued for APIs you've registered.</span></span> <span data-ttu-id="d526d-124">此令牌不适用于为 Microsoft 拥有的 API 发布的令牌，也不能用这些令牌来验证 Microsoft 标识平台将如何为所创建的 API 发布令牌。</span><span class="sxs-lookup"><span data-stu-id="d526d-124">It does not apply to tokens issued for Microsoft-owned APIs, nor can those tokens be used to validate how the Microsoft identity platform will issue tokens for an API you create.</span></span>

<span data-ttu-id="d526d-125">**应用程序配置**</span><span class="sxs-lookup"><span data-stu-id="d526d-125">**Application Configuration**</span></span>

<span data-ttu-id="d526d-126">[重定向 URI（答复 URL）限制](https://docs.microsoft.com/azure/active-directory/develop/reply-url) - 了解如何配置重定向 URI（答复 URL）。</span><span class="sxs-lookup"><span data-stu-id="d526d-126">[Redirect URI (reply URL) restrictions and limitations](https://docs.microsoft.com/azure/active-directory/develop/reply-url) - Learn how to configure your Redirect URI (reply URL).</span></span> <span data-ttu-id="d526d-127">重定向 URI 或答复 URL 是授权服务器在应用成功授权并授予用户授权代码或访问令牌后向用户发送的位置。</span><span class="sxs-lookup"><span data-stu-id="d526d-127">A redirect URI, or reply URL, is the location where the authorization server sends the user once the app has been successfully authorized and granted an authorization code or access token.</span></span> <span data-ttu-id="d526d-128">授权服务器会将代码或令牌发送到重定向 URI;因此，在应用注册过程中必须注册正确的位置。</span><span class="sxs-lookup"><span data-stu-id="d526d-128">The authorization server sends the code or token to the redirect URI; so it's important you register the correct location as part of the app registration process.</span></span>

<span data-ttu-id="d526d-129">**应用程序设置**</span><span class="sxs-lookup"><span data-stu-id="d526d-129">**Application Provisioning**</span></span>

<span data-ttu-id="d526d-130">[教程：为SCIM端点开发和计划设置](https://docs.microsoft.com/azure/active-directory/app-provisioning/use-scim-to-provision-users-and-groups) - 本文介绍如何构建 SCIM 端点和集成 AAD 设置服务。</span><span class="sxs-lookup"><span data-stu-id="d526d-130">[Tutorial: Develop and plan provisioning for a SCIM endpoint](https://docs.microsoft.com/azure/active-directory/app-provisioning/use-scim-to-provision-users-and-groups) - This article describes how to build an SCIM endpoint and integrate with the AAD provisioning service.</span></span>


